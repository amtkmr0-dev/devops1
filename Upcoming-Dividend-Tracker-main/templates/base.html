<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>{% block title %}Dividend Scanner{% endblock %}</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Core theme tokens */
            --bg: #f7f9fa;
            --card: #ffffff;
            --card-bg: var(--card);
            --text: #202124;
            --muted: #6b7280;
            --accent: #1e6fd8;
            --border: #e6e9ee;
            --success: #16a34a;
            --danger: #ef4444;
            --shadow: 0 6px 18px rgba(18, 24, 36, 0.08);
            --glass: rgba(255, 255, 255, 0.6);
            --radius: 10px;
            --transition-fast: 140ms;
        }

        body {
            font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
            margin: 0;
            background: var(--bg);
            color: var(--text);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            transition: background var(--transition-fast) ease, color var(--transition-fast) ease;
        }

        .site-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.85rem 1.25rem;
            background: var(--card-bg);
            box-shadow: var(--shadow);
            border-bottom: 1px solid transparent;
            border-radius: 0 0 var(--radius) var(--radius);
        }

        .site-brand {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 700;
            color: var(--accent);
        }

        /* Profile avatar & dropdown styling */
        .profile-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent), #3aa0ff);
            color: #fff;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.95rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .profile-name {
            display: inline-block;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 8rem;
            color: var(--text);
            font-size: 0.95rem;
        }

        /* Profile container and dropdown (responsive, touch-friendly) */
        .profile-container {
            position: relative;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .profile-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            border: none;
            background: transparent;
            cursor: pointer;
            padding: 0.35rem 0.5rem;
            border-radius: 8px;
            transition: background var(--transition-fast) ease, transform 80ms ease;
            -webkit-tap-highlight-color: transparent;
        }

        .profile-btn:active {
            transform: translateY(1px);
        }

        .profile-btn:focus {
            outline: 2px solid rgba(25, 118, 210, 0.18);
            outline-offset: 2px;
        }

        .profile-dropdown {
            min-width: 180px;
            background: var(--card-bg);
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
            position: absolute;
            right: 0;
            top: calc(100% + 8px);
            display: none;
            border-radius: 10px;
            padding: 0.25rem 0.25rem;
            z-index: 1200;
            overflow: hidden;
        }

        .profile-dropdown a {
            display: block;
            padding: 0.55rem 0.9rem;
            color: var(--text);
            text-decoration: none;
            font-size: 0.95rem;
            border-radius: 6px;
            transition: background var(--transition-fast);
        }

        .profile-dropdown a:hover {
            background: rgba(30, 110, 216, 0.06);
            color: var(--accent);
        }

        /* Mobile: make dropdown full-width below header and easy to tap */
        @media (max-width: 720px) {
            .profile-dropdown {
                position: static;
                display: none;
                width: 100%;
                margin-top: 0.5rem;
                box-shadow: none;
                border-radius: 8px;
                padding: 0.25rem 0;
            }

            .profile-container.mobile-expanded .profile-dropdown {
                display: block;
            }

            .profile-btn {
                padding: 0.5rem;
            }

            .profile-name {
                max-width: 6rem;
            }
        }

        .nav-links {
            display: flex;
            gap: 0.6rem;
            align-items: center;
        }

        .nav-links a {
            color: var(--muted);
            padding: 0.28rem 0.45rem;
            border-radius: 6px;
            transition: background var(--transition-fast), color var(--transition-fast);
        }

        .nav-links a:hover {
            color: var(--accent);
            background: rgba(30, 110, 216, 0.06);
        }

        .container {
            max-width: 1180px;
            margin: 1.2rem auto;
            padding: 0 1rem;
        }

        /* Responsive header: stack on small screens */
        @media (max-width: 720px) {
            .site-header {
                flex-direction: column;
                align-items: stretch;
                gap: 0.6rem;
                padding: 0.75rem 1rem;
            }

            .site-brand {
                padding-bottom: 0.2rem
            }

            .nav-links {
                justify-content: space-between;
                width: 100%;
                flex-wrap: wrap;
                gap: 0.5rem;
            }

            .nav-links a {
                font-size: 0.95rem
            }

            .profile-name {
                display: inline-block;
                max-width: 6rem
            }
        }

        a {
            color: inherit;
            text-decoration: none
        }

        /* Button system */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.45rem;
            padding: 0.45rem 0.8rem;
            border-radius: 8px;
            border: none;
            background: var(--accent);
            color: #fff;
            font-weight: 600;
            cursor: pointer;
            transition: transform 80ms, box-shadow var(--transition-fast);
        }

        .btn:focus {
            outline: 2px solid rgba(30, 110, 216, 0.14);
            outline-offset: 2px;
        }

        .btn-ghost {
            background: transparent;
            color: var(--text);
            border: 1px solid var(--border);
        }

        .btn-outline {
            background: transparent;
            color: var(--accent);
            border: 1px solid rgba(30, 110, 216, 0.12);
        }

        .btn-small {
            padding: 0.28rem 0.6rem;
            font-size: 0.95rem;
            border-radius: 6px;
        }

        .btn-success {
            background: var(--success);
        }

        .btn-clear {
            background: transparent;
            color: var(--muted);
        }

        .muted {
            color: #777
        }

        /* small utilities used by child templates */
        .search-input {
            padding: 0.45rem 0.9rem;
            border-radius: 8px;
            border: 1px solid var(--border);
            min-width: 220px;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.7), rgba(250, 250, 250, 0.7));
        }
    </style>
    {% block head %}{% endblock %}
</head>

<body>
    <header class="site-header">
        <div class="site-brand">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect width="24" height="24" rx="6" fill="var(--accent)" />
                <path d="M6 15L10 9l4 6" stroke="#fff" stroke-width="1.5" stroke-linecap="round"
                    stroke-linejoin="round" />
            </svg>
            <div>
                <div style="font-size:0.95rem">Dividend Scanner</div>
                <div class="muted" style="font-size:0.78rem">Corporate action & dividend tracker</div>
            </div>
        </div>
        <nav class="nav-links">
            <a href="/" class="muted" style="margin-right:8px">Home</a>
            <a href="/modern" class="muted" style="margin-right:8px">Dashboard</a>
            <!-- Profile dropdown (right aligned) -->
            <div id="globalProfilePlaceholder">
                {% if current_user.is_authenticated %}
                <div class="profile-container" id="globalProfileContainer">
                    <button class="profile-btn" id="globalProfileBtn" aria-haspopup="true" aria-expanded="false">
                        <div class="profile-avatar">{{ (current_user.first_name[:1] if current_user.first_name else
                            current_user.username[:1])|upper }}</div>
                        <div class="profile-name" style="font-weight:600">{{ current_user.first_name or
                            current_user.username }}</div>
                    </button>
                    <div class="profile-dropdown" id="globalProfileDropdown">
                        <a href="{{ url_for('profile') }}">Profile</a>
                        <a href="{{ url_for('settings') }}">Settings</a>
                        <a href="#">Portfolio</a>
                        <div style="height:1px;background:var(--border);margin:6px 0"></div>
                        <!-- Theme toggle moved into profile dropdown for consistent placement -->
                        <a href="#" id="profileThemeToggle" role="button" aria-pressed="false">Toggle Theme</a>
                        <a href="{{ url_for('logout') }}">Logout</a>
                    </div>
                </div>
                {% else %}
                <div style="display:inline-flex;gap:0.5rem;align-items:center">
                    <a href="{{ url_for('login') }}" class="muted">Login</a>
                    <a href="{{ url_for('register') }}" class="muted">Register</a>
                </div>
                {% endif %}
            </div>
        </nav>
    </header>
    <main class="container">
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div style="margin:0 0 1rem 0;">
            {% for category, msg in messages %}
            {% if category == 'error' %}
            <div
                style="padding:0.8rem 1rem;border-radius:8px;margin-bottom:0.5rem;background:#ffe6e6;border:1px solid var(--border);color:#a33">
                {{ msg }}</div>
            {% else %}
            <div
                style="padding:0.8rem 1rem;border-radius:8px;margin-bottom:0.5rem;background:#e8f5e9;border:1px solid var(--border);color:#256a36">
                {{ msg }}</div>
            {% endif %}
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}
        {% block content %}{% endblock %}
    </main>
    <footer
        style="padding:1rem 2rem;margin-top:2rem;background:transparent;color:#888;text-align:center;font-size:0.9rem">
        Built for demonstration â€” &copy; {{ now().year }}
    </footer>
    {% block scripts %}{% endblock %}
    <script>
        (function () {
            const btn = document.getElementById('globalProfileBtn');
            const dropdown = document.getElementById('globalProfileDropdown');
            const container = document.getElementById('globalProfileContainer');
            if (!btn || !dropdown || !container) return;
            const isMobile = () => window.matchMedia('(max-width:720px)').matches;

            function closeD() {
                dropdown.style.display = 'none';
                container.classList.remove('mobile-expanded');
                btn.setAttribute('aria-expanded', 'false');
            }

            function openD() {
                if (isMobile()) {
                    container.classList.add('mobile-expanded');
                    dropdown.style.display = 'block';
                } else {
                    dropdown.style.display = 'block';
                }
                btn.setAttribute('aria-expanded', 'true');
            }

            btn.addEventListener('click', e => {
                e.stopPropagation();
                if (dropdown.style.display === 'block' || container.classList.contains('mobile-expanded')) {
                    closeD();
                } else {
                    openD();
                }
            });

            document.addEventListener('click', e => { if (!container.contains(e.target)) closeD(); });
            document.addEventListener('keydown', e => { if (e.key === 'Escape') closeD(); });
            window.addEventListener('resize', () => { if (!isMobile()) container.classList.remove('mobile-expanded'); dropdown.style.display = 'none'; });
        })();
    </script>
    <script>
        // Centralized theme initialization and profile-dropdown toggle wiring
        (function () {
            function applyTheme(theme) {
                if (theme === 'dark') document.body.classList.add('dark');
                else document.body.classList.remove('dark');
            }

            // apply stored theme on load
            const stored = localStorage.getItem('theme');
            if (stored) applyTheme(stored);

            // profile dropdown toggle link
            const tlink = document.getElementById('profileThemeToggle');
            if (tlink) {
                function updateAria() {
                    const isDark = document.body.classList.contains('dark');
                    tlink.setAttribute('aria-pressed', isDark ? 'true' : 'false');
                    tlink.textContent = isDark ? 'Switch to Light' : 'Switch to Dark';
                }
                updateAria();
                tlink.addEventListener('click', function (e) {
                    e.preventDefault();
                    const nowDark = document.body.classList.toggle('dark');
                    localStorage.setItem('theme', nowDark ? 'dark' : 'light');
                    updateAria();
                });
            }
        })();
    </script>
</body>

</html>